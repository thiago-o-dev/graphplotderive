<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interactive Function Graph with Tangent Line</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 20px;
    }
    #functionSelect {
      margin-bottom: 20px;
    }
    canvas {
      max-width: 90%;
      margin: auto;
    }
  </style>
</head>
<body>

  <h1>Interactive Graph with Tangent Line</h1>

  <!-- Dropdown to select a function -->
  <label for="functionSelect">Choose a function: </label>
  <select id="functionSelect">
    <option value="x^2">f(x) = x²</option>
    <option value="sin">f(x) = sin(x)</option>
    <option value="cos">f(x) = cos(x)</option>
  </select>

  <!-- Canvas for Chart.js -->
  <canvas id="myChart" width="400" height="400"></canvas>

  <script>
    const ctx = document.getElementById('myChart').getContext('2d');
    let selectedFunction = 'x^2'; // Default function

    // Function to plot based on selected type
    function getFunctionData(func, range = [-5, 5]) {
      const data = [];
      for (let x = range[0]; x <= range[1]; x += 0.1) {
        let y;
        switch (func) {
          case 'sin':
            y = Math.sin(x);
            break;
          case 'cos':
            y = Math.cos(x);
            break;
          case 'x^2':
            y = x * x;
            break;
        }
        data.push({ x, y });
      }
      return data;
    }

    // Initial function data
    let functionData = getFunctionData(selectedFunction);

    const chart = new Chart(ctx, {
      type: 'line',
      data: {
        datasets: [{
          label: `f(x) = ${selectedFunction}`,
          data: functionData,
          borderColor: 'rgba(75, 192, 192, 1)',
          fill: false,
        }]
      },
      options: {
        responsive: true,
        scales: {
          x: { type: 'linear', position: 'bottom' },
          y: { type: 'linear', position: 'left' },
        },
        onClick: function(e) {
          // Get mouse position
          const mousePosition = Chart.helpers.getRelativePosition(e, this);
          const xValue = this.scales['x'].getValueForPixel(mousePosition.x);
          const yValue = getFunctionValue(xValue, selectedFunction);

          // Calculate the derivative (slope) at this point
          let slope;
          switch (selectedFunction) {
            case 'x^2':
              slope = 2 * xValue; // Derivative of x²
              break;
            case 'sin':
              slope = Math.cos(xValue); // Derivative of sin(x)
              break;
            case 'cos':
              slope = -Math.sin(xValue); // Derivative of cos(x)
              break;
          }

          // Create the tangent line: y - y0 = m(x - x0)
          const tangentData = {
            label: `Tangent at x = ${xValue}`,
            data: [
              { x: xValue - 1, y: slope * (xValue - 1) + yValue },
              { x: xValue + 1, y: slope * (xValue + 1) + yValue }
            ],
            borderColor: 'rgba(255, 99, 132, 1)',
            fill: false,
            borderWidth: 2,
            pointRadius: 0,
          };

          // Add the tangent line to the chart
          this.data.datasets.push(tangentData);
          this.update();
        }
      }
    });

    // Function to evaluate f(x) based on the selected function
    function getFunctionValue(x, func) {
      switch (func) {
        case 'sin':
          return Math.sin(x);
        case 'cos':
          return Math.cos(x);
        case 'x^2':
          return x * x;
      }
    }

    // Update the function when a new one is selected from the dropdown
    document.getElementById('functionSelect').addEventListener('change', function(e) {
      selectedFunction = e.target.value;
      functionData = getFunctionData(selectedFunction);
      
      // Update the chart data
      chart.data.datasets[0].data = functionData;
      chart.data.datasets[0].label = `f(x) = ${selectedFunction}`;
      chart.update();
    });
  </script>
</body>
</html>